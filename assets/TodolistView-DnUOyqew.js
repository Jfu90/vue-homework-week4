import{s as R,r as $,j as S,u as E,k as U,c as s,b as t,f as h,g as _,e as w,w as b,v as D,d as p,n as L,F as V,l as I,t as m,o as a,h as k,a as M,m as O}from"./index-DjDv5QpG.js";import{u as F,a as r}from"./axios-D1MBucRy.js";const P="/vue-homework-week4/nono.png",j={id:"todoListPage",class:"bg-half"},q={class:"todo_sm"},G={class:"conatiner todoListPage vhContainer"},H={class:"todoList_Content"},J={class:"inputBox"},K=t("i",{class:"fa fa-plus"},null,-1),Q=[K],W={key:0},X=t("h1",{style:{"text-align":"center",margin:"60px auto 20px"}},"目前尚無待辦事項",-1),Y=t("img",{src:P,alt:"目前尚無待辦事項",style:{width:"60%",margin:"auto",display:"block"}},null,-1),Z=[X,Y],tt={key:1,class:"todoList_list"},et={class:"todoList_tab"},ot={class:"todoList_items"},st={class:"todoList_item"},at={key:0},nt={class:"todoList_label"},lt=["onUpdate:modelValue","onClick"],it=["onClick"],rt=t("i",{class:"fa fa-times"},null,-1),ct=[rt],dt={class:"todoList_statistics"},ut={key:0},ht={key:1},c="https://todolist-api.hexschool.io",kt={__name:"TodolistView",setup(_t){const z=F(),{nameStore:T}=R(z),l=$([]),C=$(!1),d=$(""),g=S(()=>l.value.reduce((e,i)=>e=i.status?e:e+1,0)),f=E(),n=document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*todoToken\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1");(async()=>{if(n)try{const e=await r.get(`${c}/users/checkout`,{headers:{Authorization:n}});v(),T.value=e.data.nickname}catch{alert("驗證失敗"),f.push("/login")}else alert("token勒 ???"),f.push("/login")})();const A=async()=>{try{await r.post(`${c}/users/sign_out`,{},{headers:{Authorization:n}}),f.push("/login")}catch(e){alert(e.response.data.message)}},v=async()=>{try{const{data:e}=await r.get(`${c}/todos/`,{headers:{Authorization:n}});l.value=e.data}catch{alert("取得失敗")}C.value=!l.value.length},x=async()=>{if(d.value)try{await r.post(`${c}/todos/`,{content:d.value},{headers:{Authorization:n}}),d.value="",v()}catch{alert("新增失敗")}else alert("想一想待辦內容吧！")},N=async e=>{try{await r.delete(`${c}/todos/${e}`,{headers:{Authorization:n}}),v()}catch{alert("移除失敗")}},B=async e=>{try{await r.patch(`${c}/todos/${e}/toggle`,{},{headers:{Authorization:n}}),v()}catch{alert("切換狀態失敗")}};return(e,i)=>{const u=U("RouterLink");return a(),s("div",j,[t("nav",null,[t("h1",null,[h(u,{to:"/todolist"},{default:_(()=>[k("ONLINE TODO LIST")]),_:1})]),t("ul",null,[t("li",q,[h(u,{to:"/todolist"},{default:_(()=>[t("span",null,m(M(T))+"的代辦",1)]),_:1})]),t("li",null,[t("a",{href:"#",onClick:w(A,["prevent"])},"登出")])])]),t("div",G,[t("div",H,[t("div",J,[b(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":i[0]||(i[0]=o=>d.value=o)},null,512),[[D,d.value]]),t("a",{href:"#",onClick:w(x,["prevent"])},Q)]),C.value?(a(),s("div",W,Z)):p("",!0),l.value.length?(a(),s("div",tt,[t("ul",et,[t("li",null,[h(u,{to:"/todolist/all",class:L(e.$route.params.status=="all"||!e.$route.params.status?"active":"")},{default:_(()=>[k("全部")]),_:1},8,["class"])]),t("li",null,[h(u,{to:"/todolist/todo",class:L(e.$route.params.status=="todo"?"active":"")},{default:_(()=>[k("待完成")]),_:1},8,["class"])]),t("li",null,[h(u,{to:"/todolist/done",class:L(e.$route.params.status=="done"?"active":"")},{default:_(()=>[k("已完成")]),_:1},8,["class"])])]),t("div",ot,[t("ul",st,[(a(!0),s(V,null,I(l.value,o=>(a(),s(V,{key:o.id},[!["todo","done"].includes(e.$route.params.status)||e.$route.params.status=="todo"&&!o.status||e.$route.params.status=="done"&&o.status?(a(),s("li",at,[t("label",nt,[b(t("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":y=>o.status=y,onClick:y=>B(o.id)},null,8,lt),[[O,o.status]]),t("span",null,m(o.content),1)]),t("a",{href:"#",onClick:w(y=>N(o.id),["prevent"])},ct,8,it)])):p("",!0)],64))),128))]),t("div",dt,[e.$route.params.status!="done"?(a(),s("p",ut,m(g.value?`${g.value} 個待完成項目`:"目前尚無待辦事項"),1)):p("",!0),e.$route.params.status=="done"?(a(),s("p",ht,m(l.value.length-g.value)+" 個已完成項目 ",1)):p("",!0)])])])):p("",!0)])])])}}};export{kt as default};
